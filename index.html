<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>이지사주 - AI 자동 만세력 분석</title>

<!-- ✅ 만세력 변환 라이브러리 (가장 먼저 로드) -->
<script src="https://cdn.jsdelivr.net/npm/solarlunar@2.0.7/lib/solarlunar.min.js"></script>
<style>
body{
  font-family:'Noto Sans KR',sans-serif;
  background:linear-gradient(135deg,#1e1b4b,#111827);
  color:#333;min-height:100vh;
  display:flex;justify-content:center;align-items:flex-start;padding:30px;
}
.container{max-width:500px;width:100%;background:#fff;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,0.2);padding:30px;}
h1{text-align:center;color:#374151;margin-bottom:20px;}
label{font-weight:500;display:block;margin-bottom:6px;}
input,select{
  width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;font-size:16px;margin-bottom:12px;
}
button{
  width:100%;padding:13px;background:#4f46e5;border:none;border-radius:8px;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;
}
button:hover{background:#4338ca;}
#loading{display:none;text-align:center;font-size:16px;font-weight:500;color:#4b5563;}
</style>
</head>

<body>
<div class="container">
  <h1>이지사주 AI 무료 분석</h1>
  <form id="sajuForm">
    <label>이름</label>
    <input id="name" required placeholder="홍길동">

    <label>전화번호</label>
    <input id="phone" type="tel" required placeholder="01012345678">

    <label>성별</label>
    <select id="gender" required>
      <option value="남성">남성</option>
      <option value="여성">여성</option>
    </select>

    <label>생년월일</label>
    <div style="display:flex;gap:8px;">
      <select id="year" required></select>
      <select id="month" required></select>
      <select id="day" required></select>
    </div>

    <label>출생시각</label>
    <select id="hour" required>
      <option value="">--시 선택--</option>
      <option value="0">자시(23~01)</option>
      <option value="2">축시(01~03)</option>
      <option value="4">인시(03~05)</option>
      <option value="6">묘시(05~07)</option>
      <option value="8">진시(07~09)</option>
      <option value="10">사시(09~11)</option>
      <option value="12">오시(11~13)</option>
      <option value="14">미시(13~15)</option>
      <option value="16">신시(15~17)</option>
      <option value="18">유시(17~19)</option>
      <option value="20">술시(19~21)</option>
      <option value="22">해시(21~23)</option>
    </select>

    <label>궁금한 점</label>
    <input id="question" placeholder="예: 내년 진로운이 궁금해요">

    <div style="margin:12px 0;">
      <label><input type="checkbox" id="agree"> [필수] 개인정보 수집/이용에 동의</label>
    </div>

    <button type="submit" id="sendBtn" disabled>AI 무료 분석 신청</button>
  </form>
  <div id="loading">🔮 운명을 분석 중입니다...</div>
</div>
<!-- ✅ 솔라루나르 대신 직접 천간·지지 계산 스크립트 -->
<script>
const TENGAN = ['갑','을','병','정','무','기','경','신','임','계'];
const JIJI   = ['자','축','인','묘','진','사','오','미','신','유','술','해'];
function getYearJoo(year){
  const s=(year-4)%10,b=(year-4)%12;
  return TENGAN[s]+JIJI[b];
}
function getMonthJoo(yearJoo,month){
  const yIndex=TENGAN.indexOf(yearJoo[0]);
  const s=((yIndex%5)*2+2+month-1)%10;
  const b=(month+1)%12;
  return TENGAN[s]+JIJI[b];
}
function getDayJoo(dateStr){
  const base=new Date(1900,0,1);
  const input=new Date(dateStr);
  const diff=Math.floor((input-base)/86400000);
  const s=(6+diff)%10,b=(0+diff)%12;
  return TENGAN[(s+10)%10]+JIJI[(b+12)%12];
}
function getTimeJoo(dayStem,hour){
  const base=TENGAN.indexOf(dayStem);
  const b=Math.floor((hour+1)/2)%12;
  const s=((base*2)+Math.floor(b/2))%10;
  return TENGAN[s]+JIJI[b];
}
function calcFourPillars(y,m,d,h){
  const yj=getYearJoo(y);
  const mj=getMonthJoo(yj,m);
  const dj=getDayJoo(`${y}-${m}-${d}`);
  const tj=getTimeJoo(dj[0],h);
  return {yearJoo:yj,monthJoo:mj,dayJoo:dj,timeJoo:tj};
}
</script>
<script>
// ====== 기본 날짜 선택 ======
(function(){
  const ySel=document.getElementById('year'),
        mSel=document.getElementById('month'),
        dSel=document.getElementById('day');
  const thisY=new Date().getFullYear();
  for(let i=thisY;i>=1930;i--){ySel.innerHTML+=`<option value="${i}">${i}년</option>`;}
  for(let i=1;i<=12;i++){mSel.innerHTML+=`<option value="${i}">${i}월</option>`;}
  for(let i=1;i<=31;i++){dSel.innerHTML+=`<option value="${i}">${i}일</option>`;}
})();

// ====== 동의 체크 → 버튼 활성화 ======
const agree=document.getElementById('agree');
const btn=document.getElementById('sendBtn');
agree.addEventListener('change',()=>btn.disabled=!agree.checked);

// ====== 폼 제출 ======
document.getElementById('sajuForm').addEventListener('submit',async(e)=>{
  e.preventDefault();
  document.getElementById('loading').style.display='block';

  const name=document.getElementById('name').value;
  const phone=document.getElementById('phone').value;
  const gender=document.getElementById('gender').value;
  const year=+document.getElementById('year').value;
  const month=+document.getElementById('month').value;
  const day=+document.getElementById('day').value;
  const hour=+document.getElementById('hour').value;
  const question=document.getElementById('question').value;

  // ✅ 만세력 변환
 // const lunar=solarlunar.solar2lunar(year,month,day);
  const gan=['갑','을','병','정','무','기','경','신','임','계'];
  const ji=['자','축','인','묘','진','사','오','미','신','유','술','해'];
  const idx=Math.floor((hour+1)/2)%12;
  const timeJoo=gan[idx%10]+ji[idx];

  // 그리고 아래부분 수정
const data = {
  name, phone, gender,
  yearJoo: pillars.yearJoo,
  monthJoo: pillars.monthJoo,
  dayJoo: pillars.dayJoo,
  timeJoo: pillars.timeJoo,
  question
};

  // ✅ Apps Script URL
  const url='https://script.google.com/macros/s/AKfycbx7L_12jLzdZEM3xuUKdfsroY8IKmDFcEB-sNKPAsfJQZXwbNUes1DluYPDrgamsRbUqw/exec';

  try{
    const res=await fetch(url,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    if(!res.ok) throw new Error('서버 오류');
    window.location.href=url+'?status=ok';
  }catch(err){
    alert('서버 전송 중 오류가 발생했습니다. 잠시 후 재시도 해주세요.');
    console.error(err);
  }finally{
    document.getElementById('loading').style.display='none';
  }
});
</script>
</body>
</html>
