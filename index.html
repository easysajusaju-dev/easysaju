<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì´ì§€ì‚¬ì£¼ - AI ìë™ ë§Œì„¸ë ¥ ë¶„ì„</title>

<!-- âœ… ë§Œì„¸ë ¥ ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ê°€ì¥ ë¨¼ì € ë¡œë“œ) -->
<script src="https://cdn.jsdelivr.net/npm/solarlunar@2.0.7/lib/solarlunar.min.js"></script>
<style>
body{
  font-family:'Noto Sans KR',sans-serif;
  background:linear-gradient(135deg,#1e1b4b,#111827);
  color:#333;min-height:100vh;
  display:flex;justify-content:center;align-items:flex-start;padding:30px;
}
.container{max-width:500px;width:100%;background:#fff;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,0.2);padding:30px;}
h1{text-align:center;color:#374151;margin-bottom:20px;}
label{font-weight:500;display:block;margin-bottom:6px;}
input,select{
  width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;font-size:16px;margin-bottom:12px;
}
button{
  width:100%;padding:13px;background:#4f46e5;border:none;border-radius:8px;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;
}
button:hover{background:#4338ca;}
#loading{display:none;text-align:center;font-size:16px;font-weight:500;color:#4b5563;}
</style>
</head>

<body>
<div class="container">
  <h1>ì´ì§€ì‚¬ì£¼ AI ë¬´ë£Œ ë¶„ì„</h1>
  <form id="sajuForm">
    <label>ì´ë¦„</label>
    <input id="name" required placeholder="í™ê¸¸ë™">

    <label>ì „í™”ë²ˆí˜¸</label>
    <input id="phone" type="tel" required placeholder="01012345678">

    <label>ì„±ë³„</label>
    <select id="gender" required>
      <option value="ë‚¨ì„±">ë‚¨ì„±</option>
      <option value="ì—¬ì„±">ì—¬ì„±</option>
    </select>

    <label>ìƒë…„ì›”ì¼</label>
    <div style="display:flex;gap:8px;">
      <select id="year" required></select>
      <select id="month" required></select>
      <select id="day" required></select>
    </div>

    <label>ì¶œìƒì‹œê°</label>
    <select id="hour" required>
      <option value="">--ì‹œ ì„ íƒ--</option>
      <option value="0">ìì‹œ(23~01)</option>
      <option value="2">ì¶•ì‹œ(01~03)</option>
      <option value="4">ì¸ì‹œ(03~05)</option>
      <option value="6">ë¬˜ì‹œ(05~07)</option>
      <option value="8">ì§„ì‹œ(07~09)</option>
      <option value="10">ì‚¬ì‹œ(09~11)</option>
      <option value="12">ì˜¤ì‹œ(11~13)</option>
      <option value="14">ë¯¸ì‹œ(13~15)</option>
      <option value="16">ì‹ ì‹œ(15~17)</option>
      <option value="18">ìœ ì‹œ(17~19)</option>
      <option value="20">ìˆ ì‹œ(19~21)</option>
      <option value="22">í•´ì‹œ(21~23)</option>
    </select>

    <label>ê¶ê¸ˆí•œ ì </label>
    <input id="question" placeholder="ì˜ˆ: ë‚´ë…„ ì§„ë¡œìš´ì´ ê¶ê¸ˆí•´ìš”">

    <div style="margin:12px 0;">
      <label><input type="checkbox" id="agree"> [í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘/ì´ìš©ì— ë™ì˜</label>
    </div>

    <button type="submit" id="sendBtn" disabled>AI ë¬´ë£Œ ë¶„ì„ ì‹ ì²­</button>
  </form>
  <div id="loading">ğŸ”® ìš´ëª…ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
</div>
<!-- âœ… ì†”ë¼ë£¨ë‚˜ë¥´ ëŒ€ì‹  ì§ì ‘ ì²œê°„Â·ì§€ì§€ ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸ -->
<script>
const TENGAN = ['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'];
const JIJI   = ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];
function getYearJoo(year){
  const s=(year-4)%10,b=(year-4)%12;
  return TENGAN[s]+JIJI[b];
}
function getMonthJoo(yearJoo,month){
  const yIndex=TENGAN.indexOf(yearJoo[0]);
  const s=((yIndex%5)*2+2+month-1)%10;
  const b=(month+1)%12;
  return TENGAN[s]+JIJI[b];
}
function getDayJoo(dateStr){
  const base=new Date(1900,0,1);
  const input=new Date(dateStr);
  const diff=Math.floor((input-base)/86400000);
  const s=(6+diff)%10,b=(0+diff)%12;
  return TENGAN[(s+10)%10]+JIJI[(b+12)%12];
}
function getTimeJoo(dayStem,hour){
  const base=TENGAN.indexOf(dayStem);
  const b=Math.floor((hour+1)/2)%12;
  const s=((base*2)+Math.floor(b/2))%10;
  return TENGAN[s]+JIJI[b];
}
function calcFourPillars(y,m,d,h){
  const yj=getYearJoo(y);
  const mj=getMonthJoo(yj,m);
  const dj=getDayJoo(`${y}-${m}-${d}`);
  const tj=getTimeJoo(dj[0],h);
  return {yearJoo:yj,monthJoo:mj,dayJoo:dj,timeJoo:tj};
}
</script>
<script>
// ====== ê¸°ë³¸ ë‚ ì§œ ì„ íƒ ======
(function(){
  const ySel=document.getElementById('year'),
        mSel=document.getElementById('month'),
        dSel=document.getElementById('day');
  const thisY=new Date().getFullYear();
  for(let i=thisY;i>=1930;i--){ySel.innerHTML+=`<option value="${i}">${i}ë…„</option>`;}
  for(let i=1;i<=12;i++){mSel.innerHTML+=`<option value="${i}">${i}ì›”</option>`;}
  for(let i=1;i<=31;i++){dSel.innerHTML+=`<option value="${i}">${i}ì¼</option>`;}
})();

// ====== ë™ì˜ ì²´í¬ â†’ ë²„íŠ¼ í™œì„±í™” ======
const agree=document.getElementById('agree');
const btn=document.getElementById('sendBtn');
agree.addEventListener('change',()=>btn.disabled=!agree.checked);

// ====== í¼ ì œì¶œ ======
document.getElementById('sajuForm').addEventListener('submit',async(e)=>{
  e.preventDefault();
  document.getElementById('loading').style.display='block';

  const name=document.getElementById('name').value;
  const phone=document.getElementById('phone').value;
  const gender=document.getElementById('gender').value;
  const year=+document.getElementById('year').value;
  const month=+document.getElementById('month').value;
  const day=+document.getElementById('day').value;
  const hour=+document.getElementById('hour').value;
  const question=document.getElementById('question').value;

  // âœ… ë§Œì„¸ë ¥ ë³€í™˜
 // const lunar=solarlunar.solar2lunar(year,month,day);
  const gan=['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'];
  const ji=['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];
  const idx=Math.floor((hour+1)/2)%12;
  const timeJoo=gan[idx%10]+ji[idx];

  // ê·¸ë¦¬ê³  ì•„ë˜ë¶€ë¶„ ìˆ˜ì •
const data = {
  name, phone, gender,
  yearJoo: pillars.yearJoo,
  monthJoo: pillars.monthJoo,
  dayJoo: pillars.dayJoo,
  timeJoo: pillars.timeJoo,
  question
};

  // âœ… Apps Script URL
  const url='https://script.google.com/macros/s/AKfycbx7L_12jLzdZEM3xuUKdfsroY8IKmDFcEB-sNKPAsfJQZXwbNUes1DluYPDrgamsRbUqw/exec';

  try{
    const res=await fetch(url,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    if(!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
    window.location.href=url+'?status=ok';
  }catch(err){
    alert('ì„œë²„ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ì¬ì‹œë„ í•´ì£¼ì„¸ìš”.');
    console.error(err);
  }finally{
    document.getElementById('loading').style.display='none';
  }
});
</script>
</body>
</html>
